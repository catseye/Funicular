PLATFORM="i386-qemu"
INSTALL_IMAGE='NetBSD-9.3-i386.iso'
INSTALL_IMAGE_URL='https://cdn.netbsd.org/pub/NetBSD/NetBSD-9.3/images/NetBSD-9.3-i386.iso'
SETUP_IMAGE='setup-netbsd.iso'
SYSTEM_IMAGE='wd0.img'
DIST_IMAGE='floppy.img'

DISTFILES="
  https://static.catseye.tc/distfiles/netusb-0.1.zip
"

# GENERIC (20M) -> GENERIC_TINY (2.4M)
### mv /netbsd /netbsd.old ; mv /usr/src/sys/arch/GENERIC_TINY/compile/GENERIC_TINY/netbsd /

# mkdir isobuild
# cp /usr/src/sys/arch/GENERIC_TINY/compile/GENERIC_TINY/netbsd isobuild/
# mkdir systree  # XXX and populate with ?????
# makefs -s 2880 -t ffs md.img systree
# mdsetimage -v -s isobuild/netbsd md.img
# ( cd isobuild && gzip -f -9 netbsd && mv netbsd.gz netbsd )

# ( cd /usr/src/sys/arch/i386/stand/cdboot && make )
# cp /usr/src/sys/arch/i386/stand/cdboot/cdboot isobuild/

install_instructions() {
    cat <<EOF
* At the boot menu, select "1. Boot normally" (or just wait)
* After it boots, select a language for installation messages, and a keyboard type.
* Select language, keyboard ("unchanged" should be OK)
* At the next menu, select "Install NetBSD to hard disk".  Then "yes".
* At "Available disks", select "a. wd0".  Then select "MBR".
* This is the correct geometry.
* Use the entire disk.
* Use default partition sizes.  Partition sizes ok.
* Shall we continue?  Yes.
* At "Bootblocks selection": Use BIOS console.
* At the "Select your distribution" menu, select "Custom installation".
* At the next menu, arrow up to "Compiler Tools" and hit Enter to select it.
* Then arrow down to "Source and debug sets", and hit Enter to select it.
* Inside it, select "Kernel sources".  Then press "x" then Enter
* Press "x" then Enter again to "Install selected sets".
* If you install from CD-ROM you won't have the kernel sources.
* Instead "Install from HTTP".
* Press "j" to configure network.  Select interface "wm0".
* Network media type: just press Enter.  Perform autoconfiguration?  Yes.
* Your DNS domain: just press Enter.  Are they OK?  Yes.
* Press "x" to "Get distribution".
* WAIT.  Wait for the IPv6 address to timeout.  It will fall back to IPv4.
* Is the network information accurate?  Yes.
* The extraction is complete.  Hit Enter.
* Select "e" to "Enable installation of binary packages".
* Select "x" and press Enter.  And wait a lot.
* When that's done - don't bother configuring anything else.
* When back at the main menu, select "Exit Install System" and type 'shutdown -p now'
EOF
}

# pkg_add http://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD/i386/9.3/All/pkgin
# pkgin -4 -V install mklivecd nano python39

setup_instructions() {
    cat <<EOF
* Login as root (which will not have a password. You may or may not wish to give it one,
  depending on your security needs.)
* As root, run:
        mount /cdrom
        cp /cdrom/setup-netbsd.sh .
        . ./setup-netbsd.sh
* Follow the instructions in the script.
* Once it is finished, log out and log in again as 'user'. (You may or may not wish to
  run passwd to give user a password at this point, depending on your security needs.)
* Then run:
        sh /cdrom/populate-shelf.sh 2>&1 | tee populate-log.txt
        sh /cdrom/build-shelf.sh 2>&1 | tee build-log.txt
EOF
}
